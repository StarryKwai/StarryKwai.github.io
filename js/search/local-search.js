"use strict";function _typeof26(t){return(_typeof26="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _typeof25(t){return(_typeof25="function"==typeof Symbol&&"symbol"==_typeof26(Symbol.iterator)?function(t){return _typeof26(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof26(t)})(t)}function _typeof24(t){return(_typeof24="function"==typeof Symbol&&"symbol"==_typeof25(Symbol.iterator)?function(t){return _typeof25(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof25(t)})(t)}function _typeof23(t){return(_typeof23="function"==typeof Symbol&&"symbol"==_typeof24(Symbol.iterator)?function(t){return _typeof24(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof24(t)})(t)}function _typeof22(t){return(_typeof22="function"==typeof Symbol&&"symbol"==_typeof23(Symbol.iterator)?function(t){return _typeof23(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof23(t)})(t)}function _typeof21(t){return(_typeof21="function"==typeof Symbol&&"symbol"==_typeof22(Symbol.iterator)?function(t){return _typeof22(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof22(t)})(t)}function _typeof20(t){return(_typeof20="function"==typeof Symbol&&"symbol"==_typeof21(Symbol.iterator)?function(t){return _typeof21(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof21(t)})(t)}function _typeof19(t){return(_typeof19="function"==typeof Symbol&&"symbol"==_typeof20(Symbol.iterator)?function(t){return _typeof20(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof20(t)})(t)}function _typeof18(t){return(_typeof18="function"==typeof Symbol&&"symbol"==_typeof19(Symbol.iterator)?function(t){return _typeof19(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof19(t)})(t)}function _typeof17(t){return(_typeof17="function"==typeof Symbol&&"symbol"==_typeof18(Symbol.iterator)?function(t){return _typeof18(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof18(t)})(t)}function _typeof16(t){return(_typeof16="function"==typeof Symbol&&"symbol"==_typeof17(Symbol.iterator)?function(t){return _typeof17(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof17(t)})(t)}function _typeof15(t){return(_typeof15="function"==typeof Symbol&&"symbol"==_typeof16(Symbol.iterator)?function(t){return _typeof16(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof16(t)})(t)}function _typeof14(t){return(_typeof14="function"==typeof Symbol&&"symbol"==_typeof15(Symbol.iterator)?function(t){return _typeof15(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof15(t)})(t)}function _typeof13(t){return(_typeof13="function"==typeof Symbol&&"symbol"==_typeof14(Symbol.iterator)?function(t){return _typeof14(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof14(t)})(t)}function _typeof12(t){return(_typeof12="function"==typeof Symbol&&"symbol"==_typeof13(Symbol.iterator)?function(t){return _typeof13(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof13(t)})(t)}function _typeof11(t){return(_typeof11="function"==typeof Symbol&&"symbol"==_typeof12(Symbol.iterator)?function(t){return _typeof12(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof12(t)})(t)}function _typeof10(t){return(_typeof10="function"==typeof Symbol&&"symbol"==_typeof11(Symbol.iterator)?function(t){return _typeof11(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof11(t)})(t)}function _typeof9(t){return(_typeof9="function"==typeof Symbol&&"symbol"==_typeof10(Symbol.iterator)?function(t){return _typeof10(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof10(t)})(t)}function _typeof8(t){return(_typeof8="function"==typeof Symbol&&"symbol"==_typeof9(Symbol.iterator)?function(t){return _typeof9(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof9(t)})(t)}function _typeof7(t){return(_typeof7="function"==typeof Symbol&&"symbol"==_typeof8(Symbol.iterator)?function(t){return _typeof8(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof8(t)})(t)}function _typeof6(t){return(_typeof6="function"==typeof Symbol&&"symbol"==_typeof7(Symbol.iterator)?function(t){return _typeof7(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof7(t)})(t)}function _typeof5(t){return(_typeof5="function"==typeof Symbol&&"symbol"==_typeof6(Symbol.iterator)?function(t){return _typeof6(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof6(t)})(t)}function _typeof4(t){return(_typeof4="function"==typeof Symbol&&"symbol"==_typeof5(Symbol.iterator)?function(t){return _typeof5(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof5(t)})(t)}function _typeof3(t){return(_typeof3="function"==typeof Symbol&&"symbol"==_typeof4(Symbol.iterator)?function(t){return _typeof4(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof4(t)})(t)}function _typeof2(t){return(_typeof2="function"==typeof Symbol&&"symbol"==_typeof3(Symbol.iterator)?function(t){return _typeof3(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof3(t)})(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(t){return _typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof2(t)})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _slicedToArray(t,o){return _arrayWithHoles(t)||_iterableToArrayLimit(t,o)||_unsupportedIterableToArray(t,o)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,o){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var n,r,i,y,l=[],u=!0,c=!1;try{if(i=(e=e.call(t)).next,0===o){if(Object(e)!==e)return;u=!1}else for(;!(u=(n=i.call(e)).done)&&(l.push(n.value),l.length!==o);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=e.return&&(y=e.return(),Object(y)!==y))return}finally{if(c)throw r}}return l}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,o){var e,n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||o&&t&&"number"==typeof t.length)return n&&(t=n),e=0,{s:o=function(){},n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:o};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,y=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){y=!0,r=t},f:function(){try{i||null==n.return||n.return()}finally{if(y)throw r}}}}function _unsupportedIterableToArray(t,o){if(t){if("string"==typeof t)return _arrayLikeToArray(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,o):void 0}}function _arrayLikeToArray(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=new Array(o);e<o;e++)n[e]=t[e];return n}function _classCallCheck(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,o,e){return o&&_defineProperties(t.prototype,o),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){return"symbol"==_typeof(t=_toPrimitive(t,"string"))?t:String(t)}function _toPrimitive(t,o){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===o?String:Number)(t);if("object"!=_typeof(e=e.call(t,o||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}var LocalSearch=function(){function n(t){var o=void 0===(o=t.path)?"":o,e=void 0!==(e=t.unescape)&&e,t=void 0===(t=t.top_n_per_article)?1:t;_classCallCheck(this,n),this.path=o,this.unescape=e,this.top_n_per_article=t,this.isfetched=!1,this.datas=null}return _createClass(n,[{key:"getIndexByWord",value:function(t,i){var y=this,l=2<arguments.length&&void 0!==arguments[2]&&arguments[2],u=[],c=new Set;return l||(i=i.toLowerCase()),t.forEach(function(t){y.unescape&&((o=document.createElement("div")).innerText=t,t=o.innerHTML);var o,e=t.length;if(0!==e){var n,r=0;for(l||(t=t.toLowerCase());-1<(n=i.indexOf(t,r));)u.push({position:n,word:t}),c.add(t),r=n+e}}),u.sort(function(t,o){return t.position!==o.position?t.position-o.position:o.word.length-t.word.length}),[u,c]}},{key:"mergeIntoSlice",value:function(t,o,e){for(var n=e[0],r=n.position,i=n.word,y=[],l=new Set;r+i.length<=o&&0!==e.length;){l.add(i),y.push({position:r,length:i.length});var u=r+i.length;for(e.shift();0!==e.length&&(r=(n=e[0]).position,i=n.word,r<u);)e.shift()}return{hits:y,start:t,end:o,count:l.size}}},{key:"highlightKeyword",value:function(t,o){var e,n="",r=o.start,i=_createForOfIteratorHelper(o.hits);try{for(i.s();!(e=i.n()).done;){var y=e.value,l=y.position,u=y.length;n+=t.substring(r,l),r=l+u,n+='<mark class="search-keyword">'.concat(t.substr(l,u),"</mark>")}}catch(t){i.e(t)}finally{i.f()}return n+t.substring(r,o.end)}},{key:"getResultItems",value:function(p){var s=this,m=[];return this.datas.forEach(function(t){var o=t.title,e=t.content,t=t.url,n=(r=_slicedToArray(s.getIndexByWord(p,o),2))[0],r=r[1],i=(y=_slicedToArray(s.getIndexByWord(p,e),2))[0],y=y[1],r=new Set([].concat(_toConsumableArray(r),_toConsumableArray(y))).size;if(0!==(y=n.length+i.length)){for(var l=[],u=(0!==n.length&&l.push(s.mergeIntoSlice(0,o.length,n)),[]);0!==i.length;){var c=i[0].position,f=Math.max(0,c-20),c=Math.min(e.length,c+100);u.push(s.mergeIntoSlice(f,c,i))}u.sort(function(t,o){return t.count!==o.count?o.count-t.count:t.hits.length!==o.hits.length?o.hits.length-t.hits.length:t.start-o.start}),0<=(n=parseInt(s.top_n_per_article,10))&&(u=u.slice(0,n));var a="";(t=new URL(t,location.origin)).searchParams.append("highlight",p.join(" ")),0!==l.length?a+='<div class="local-search-hit-item"><a href="'.concat(t.href,'"><span class="search-result-title">').concat(s.highlightKeyword(o,l[0]),"</span>"):a+='<div class="local-search-hit-item"><a href="'.concat(t.href,'"><span class="search-result-title">').concat(o,"</span>"),u.forEach(function(t){a+='<p class="search-result">'.concat(s.highlightKeyword(e,t),"...</p></a>")}),a+="</div>",m.push({item:a,id:m.length,hitCount:y,includedCount:r})}}),m}},{key:"fetchData",value:function(){var o=this,e=!this.path.endsWith("json");fetch(this.path).then(function(t){return t.text()}).then(function(t){o.isfetched=!0,o.datas=e?_toConsumableArray((new DOMParser).parseFromString(t,"text/xml").querySelectorAll("entry")).map(function(t){return{title:t.querySelector("title").textContent,content:t.querySelector("content").textContent,url:t.querySelector("url").textContent}}):JSON.parse(t),o.datas=o.datas.filter(function(t){return t.title}).map(function(t){return t.title=t.title.trim(),t.content=t.content?t.content.trim().replace(/<[^>]+>/g,""):"",t.url=decodeURIComponent(t.url).replace(/\/{2,}/g,"/"),t}),window.dispatchEvent(new Event("search:loaded"))})}},{key:"highlightText",value:function(o,t,e){var n,r=o.nodeValue,i=t.start,y=[],l=_createForOfIteratorHelper(t.hits);try{for(l.s();!(n=l.n()).done;){var u=n.value,c=u.position,f=u.length,a=document.createTextNode(r.substring(i,c)),i=c+f,p=document.createElement("mark");p.className=e,p.appendChild(document.createTextNode(r.substr(c,f))),y.push(a,p)}}catch(t){l.e(t)}finally{l.f()}o.nodeValue=r.substring(i,t.end),y.forEach(function(t){o.parentNode.insertBefore(t,o)})}},{key:"highlightSearchWords",value:function(t){var e=this,o=new URL(location.href).searchParams.get("highlight"),n=o?o.split(" "):[];if(n.length&&t){for(var r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),i=[];r.nextNode();)r.currentNode.parentNode.matches("button, select, textarea, .mermaid")||i.push(r.currentNode);i.forEach(function(t){var o=_slicedToArray(e.getIndexByWord(n,t.nodeValue),1)[0];o.length&&(o=e.mergeIntoSlice(0,t.nodeValue.length,o),e.highlightText(t,o,"search-keyword"))})}}}]),n}();window.addEventListener("load",function(){function t(){var t=document.body.style;t.width="100%",t.overflow="hidden",btf.animateIn(m,"to_show 0.5s"),btf.animateIn(b,"titleScale 0.5s"),setTimeout(function(){u.focus()},300),s||(l.isfetched||l.fetchData(),u.addEventListener("input",p),s=!0),document.addEventListener("keydown",function t(o){"Escape"===o.code&&(h(),document.removeEventListener("keydown",t))}),d(),window.addEventListener("resize",d)}function o(){btf.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",t)}var e=GLOBAL_CONFIG.localSearch,n=e.path,r=e.top_n_per_article,i=e.unescape,y=e.languages,l=new LocalSearch({path:n,top_n_per_article:r,unescape:i}),u=document.querySelector("#local-search-input input"),c=document.getElementById("local-search-stats-wrap"),f=document.getElementById("loading-status"),a=!n.endsWith("json"),p=function(){var t,o,e,n;l.isfetched&&(n=u.value.trim().toLowerCase(),""!==(n=a?n.replace(/</g,"&lt;").replace(/>/g,"&gt;"):n)&&(f.innerHTML='<i class="fas fa-spinner fa-pulse"></i>'),e=n.split(/[-\s]+/),t=document.getElementById("local-search-results"),o=[],0<n.length&&(o=l.getResultItems(e)),1===e.length&&""===e[0]?(t.textContent="",c.textContent=""):0===o.length?(t.textContent="",(e=document.createElement("div")).className="search-result-stats",e.textContent=y.hits_empty.replace(/\$\{query}/,n),c.innerHTML=e.outerHTML):(o.sort(function(t,o){return t.includedCount!==o.includedCount?o.includedCount-t.includedCount:t.hitCount!==o.hitCount?o.hitCount-t.hitCount:o.id-t.id}),n=y.hits_stats.replace(/\$\{hits}/,o.length),t.innerHTML='<div class="search-result-list">'.concat(o.map(function(t){return t.item}).join(""),"</div>"),c.innerHTML='<hr><div class="search-result-stats">'.concat(n,"</div>"),window.pjax&&window.pjax.refresh(t)),f.textContent="")},s=!1,m=document.getElementById("search-mask"),b=document.querySelector("#local-search .search-dialog"),d=function(){window.innerWidth<768&&b.style.setProperty("--search-height",window.innerHeight+"px")},h=function(){var t=document.body.style;t.width="",t.overflow="",btf.animateOut(b,"search_close .5s"),btf.animateOut(m,"to_hide 0.5s"),window.removeEventListener("resize",d)};window.addEventListener("search:loaded",function(){var t=document.getElementById("loading-database");t.nextElementSibling.style.display="block",t.remove()}),o(),document.querySelector("#local-search .search-close-button").addEventListener("click",h),m.addEventListener("click",h),GLOBAL_CONFIG.localSearch.preload&&l.fetchData(),l.highlightSearchWords(document.getElementById("article-container")),window.addEventListener("pjax:complete",function(){btf.isHidden(m)||h(),l.highlightSearchWords(document.getElementById("article-container")),o()})});